<!doctype html>
<html class="default no-js">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>structure-bytes</title>
	<meta name="description" content="Documentation for structure-bytes">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="assets/css/main.css">
	<script async src="assets/js/search.js" id="search-script"></script>
</head>
<body>
<header>
	<div class="tsd-page-toolbar">
		<div class="container">
			<div class="table-wrap">
				<div class="table-cell" id="tsd-search" data-index="assets/js/search.json" data-base=".">
					<div class="field">
						<label for="tsd-search-field" class="tsd-widget search no-caption">Search</label>
						<input id="tsd-search-field" type="text" />
					</div>
					<ul class="results">
						<li class="state loading">Preparing search index...</li>
						<li class="state failure">The search index is not available</li>
					</ul>
					<a href="index.html" class="title">structure-bytes</a>
				</div>
				<div class="table-cell" id="tsd-widgets">
					<div id="tsd-filter">
						<a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a>
						<div class="tsd-filter-group">
							<div class="tsd-select" id="tsd-filter-visibility">
								<span class="tsd-select-label">All</span>
								<ul class="tsd-select-list">
									<li data-value="public">Public</li>
									<li data-value="protected">Public/Protected</li>
									<li data-value="private" class="selected">All</li>
								</ul>
							</div>
							<input type="checkbox" id="tsd-filter-inherited" checked />
							<label class="tsd-widget" for="tsd-filter-inherited">Inherited</label>
							<input type="checkbox" id="tsd-filter-externals" checked />
							<label class="tsd-widget" for="tsd-filter-externals">Externals</label>
						</div>
					</div>
					<a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a>
				</div>
			</div>
		</div>
	</div>
	<div class="tsd-page-title">
		<div class="container">
			<h1>structure-bytes</h1>
		</div>
	</div>
</header>
<div class="container container-main">
	<div class="row">
		<div class="col-8 col-content">
			<div class="tsd-panel tsd-typography">
				<a href="#structure-bytes" id="structure-bytes" style="color: inherit; text-decoration: none;">
					<h1>structure-bytes</h1>
				</a>
				<p>A TypeScript library for efficient data serialization, achieved by separating data structure from their values and storing each in compact binary formats.</p>
				<p><a href="https://www.npmjs.com/package/structure-bytes"><img src="https://img.shields.io/npm/v/structure-bytes.svg" alt="npm Version"></a>
					<a href="https://travis-ci.org/calebsander/structure-bytes"><img src="https://travis-ci.org/calebsander/structure-bytes.svg?branch=master" alt="Build Status"></a>
					<a href="https://coveralls.io/github/calebsander/structure-bytes?branch=master"><img src="https://coveralls.io/repos/github/calebsander/structure-bytes/badge.svg?branch=master" alt="Coverage Status"></a>
					<a href="https://david-dm.org/calebsander/structure-bytes"><img src="https://david-dm.org/calebsander/structure-bytes/status.svg" alt="Dependencies"></a>
				<a href="https://david-dm.org/calebsander/structure-bytes?type=dev"><img src="https://david-dm.org/calebsander/structure-bytes/dev-status.svg" alt="Dev Dependencies"></a></p>
				<a href="#concept" id="concept" style="color: inherit; text-decoration: none;">
					<h2>Concept</h2>
				</a>
				<p>Most modern data serialization formats fall into one of two categories:</p>
				<ul>
					<li>Formats like JSON which can represent a wide range of simple and compound data types. Serialized values in these formats implicitly serialize their type so the deserializer doesn&#39;t need knowledge of the type.</li>
					<li>Formats like MP3 or PNG which represent one specific data type, such as a song or image. The serializer and deserializer must both know the file format in order to communicate.</li>
				</ul>
				<p>The aim of this project is to store values with the flexibility of JSON but the byte efficiency of dedicated formats.
					To accomplish this, custom &quot;types&quot; are constructed, implicitly defining binary serialization formats for specific categories of values.
					Types are defined from a rich set of primitive and compound types (see <a href="#data-types">Data Types</a>).
					There is a fixed (universal) serialization format for types, and each type defines a serialization format for its values.
				<code>structure-bytes</code> reduces the number of bytes needed to serialize values in several ways in comparison to JSON:</p>
				<ul>
					<li>Types and values are each serialized in binary formats with far less redundancy than JSON&#39;s text-based formats. For example, serializing a 32-bit signed integer in JSON can take up to 11 characters, whereas it requires only 4 bytes when serialized by <code>sb.IntType</code>.</li>
					<li>JSON does not require each value in an array or dictionary to have the same type, which results in highly redundant serializations of collections. <code>structure-bytes</code> serializes the type of a collection&#39;s elements as part of the type rather than the value, so it isn&#39;t repeated.</li>
					<li>One type can be used to serialize many different values. For example, when sending multiple values of the same type across a network, the type can sent along with the first value and only values need to be sent afterwards.</li>
				</ul>
				<p>This project is somewhat similar to Google&#39;s <a href="https://developers.google.com/protocol-buffers/">Protocol Buffers</a>, but was not designed to match its functionality.</p>
				<a href="#use-cases" id="use-cases" style="color: inherit; text-decoration: none;">
					<h2>Use cases</h2>
				</a>
				<ul>
					<li>Use when the structure of the data is complicated. For example, if you are serializing plaintext, this can easily be accomplished without redundancy by writing to files or sockets.</li>
					<li>Use when there is a lot of repetition in the data. If you don&#39;t have any arrays, sets, or maps, there is less redundancy for <code>structure-bytes</code> to eliminate.</li>
					<li>Use when serializing many values for the type (e.g. many files storing the same type of value, or many communications of the same type). This will give you the benefit of being able to keep only a single copy of the type spec.</li>
				</ul>
				<a href="#differences-from-protocol-buffers" id="differences-from-protocol-buffers" style="color: inherit; text-decoration: none;">
					<h2>Differences from Protocol Buffers</h2>
				</a>
				<ul>
					<li>Types have binary serializations, not just values. (Protocol Buffers requires both the serializer and deserializer to have <code>.proto</code> definition files, which are not designed to be transmitted like values.) This compactly stores complex types and allows values to be written along with their types so they can be read without knowing their types beforehand.</li>
					<li>Types are generated programmatically rather than by reading <code>.proto</code> files. This allows, for example, for a function which turns a type into another type that either contains an error message or an instance of the original type.</li>
					<li>This project is designed with downloading data over HTTP in mind. If the client has already received values of the same type, the server only sends the value and the client reads it using its cached type. If the client doesn&#39;t know the type, the server serializes it along with the value and the client caches the type. This way, the type does not need to be specified in the client-side JavaScript and repeated requests to the same endpoint are very efficient.</li>
					<li><code>structure-bytes</code> provides a larger set of primitive and compound types.</li>
				</ul>
				<a href="#data-types" id="data-types" style="color: inherit; text-decoration: none;">
					<h2>Data types</h2>
				</a>
				<ul>
					<li>Primitive types<ul>
							<li><code>Byte</code> (1-byte signed integer)</li>
							<li><code>Short</code> (2-byte signed integer)</li>
							<li><code>Int</code> (4-byte signed integer)</li>
							<li><code>Long</code> (8-byte signed integer)</li>
							<li><code>BigInt</code> (a signed integer with arbitrary precision)</li>
							<li><code>FlexInt</code> (a signed integer from <code>-(2 ** 52)</code> to <code>2 ** 52</code> with a variable-length representation)</li>
							<li><code>UnsignedByte</code> (1-byte unsigned integer)</li>
							<li><code>UnsignedShort</code> (2-byte unsigned integer)</li>
							<li><code>UnsignedInt</code> (4-byte unsigned integer)</li>
							<li><code>UnsignedLong</code> (8-byte unsigned integer)</li>
							<li><code>BigUnsignedInt</code> (an unsigned integer with arbitrary precision)</li>
							<li><code>FlexUnsignedInt</code> (an unsigned integer below <code>2 ** 53</code> with a variable-length representation)</li>
							<li><code>Date</code> (8-byte signed integer representing number of milliseconds since Jan 1, 1970)</li>
							<li><code>Day</code> (3-byte signed integer representing a specific day in history)</li>
							<li><code>Time</code> (4-byte unsigned integer representing a specific time of day)</li>
							<li><code>Float</code> (IEEE 32-bit floating-point number)</li>
							<li><code>Double</code> (IEEE 64-bit floating-point number)</li>
							<li><code>Boolean</code> (a single true or false value)</li>
							<li><code>BooleanTuple</code> (a constant-length array of <code>Boolean</code>s)</li>
							<li><code>BooleanArray</code> (a variable-length array of <code>Boolean</code>s)</li>
							<li><code>Char</code> (a single UTF-8 character)</li>
							<li><code>String</code> (UTF-8-encoded text)</li>
							<li><code>Octets</code> (an <code>ArrayBuffer</code> (raw binary data))</li>
						</ul>
					</li>
					<li>Compound/recursive types<ul>
							<li><code>Tuple&lt;Type&gt;</code> (a constant-length array of <code>Type</code>s)</li>
							<li><code>Struct</code> (an object with a fixed set of fields, each with a fixed name and type)</li>
							<li><code>Array&lt;Type&gt;</code> (a variable-length array of <code>Type</code>s)</li>
							<li><code>Set&lt;Type&gt;</code> (like an <code>Array</code>, except creates a set when read)</li>
							<li><code>Map&lt;KeyType, ValueType&gt;</code> (a mapping of <code>KeyType</code> instances to <code>ValueType</code> instances)</li>
							<li><code>Enum&lt;Type&gt;</code> (a fixed set of <code>Type</code>s; useful when only a small subset of <code>Type</code> instances represent possible values, especially with <code>String</code>s)</li>
							<li><code>Choice</code> (a fixed set of types that values can take on)</li>
							<li><code>Recursive&lt;Type&gt;</code> (a type that can reference itself and be used to serialize circular data structures)</li>
							<li><code>Singleton&lt;Type&gt;</code> (a type that serializes only one value)</li>
							<li><code>Optional&lt;Type&gt;</code> (either <code>null</code> or <code>undefined</code> or an instance of <code>Type</code>)</li>
							<li><code>Pointer&lt;Type&gt;</code> (allows multiple instances of <code>Type</code> with the same serialization to be stored only once)</li>
						</ul>
					</li>
				</ul>
				<a href="#documentation" id="documentation" style="color: inherit; text-decoration: none;">
					<h2>Documentation</h2>
				</a>
				<p>The <code>docs</code> folder is hosted at
				<a href="https://calebsander.github.io/structure-bytes/modules/_index_.html">https://calebsander.github.io/structure-bytes</a>.</p>
				<a href="#examples" id="examples" style="color: inherit; text-decoration: none;">
					<h2>Examples</h2>
				</a>
				<a href="#type-creation" id="type-creation" style="color: inherit; text-decoration: none;">
					<h3>Type creation</h3>
				</a>
				<pre><code class="language-javascript"><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">sb</span><span style="color: #000000"> = </span><span style="color: #795E26">require</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;structure-bytes&#039;</span><span style="color: #000000">)</span>

<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">colorType</span><span style="color: #000000"> = </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #795E26">TupleType</span><span style="color: #000000">({</span>
<span style="color: #000000">    </span><span style="color: #001080">type:</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #001080">UnsignedByteType</span><span style="color: #000000">,</span>
<span style="color: #000000">    </span><span style="color: #001080">length:</span><span style="color: #000000"> </span><span style="color: #098658">3</span>
<span style="color: #000000">})</span>
<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">routeAttributesType</span><span style="color: #000000"> = </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #795E26">StructType</span><span style="color: #000000">({</span>
<span style="color: #000000">    </span><span style="color: #001080">color:</span><span style="color: #000000"> </span><span style="color: #001080">colorType</span><span style="color: #000000">,</span>
<span style="color: #000000">    </span><span style="color: #001080">description:</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #795E26">PointerType</span><span style="color: #000000">(</span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #001080">StringType</span><span style="color: #000000">),</span>
<span style="color: #000000">    </span><span style="color: #001080">direction_names:</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #795E26">PointerType</span><span style="color: #000000">(</span>
<span style="color: #000000">        </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #795E26">ArrayType</span><span style="color: #000000">(</span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #001080">StringType</span><span style="color: #000000">)</span>
<span style="color: #000000">    ),</span>
<span style="color: #000000">    </span><span style="color: #001080">long_name:</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #001080">StringType</span><span style="color: #000000">,</span>
<span style="color: #000000">    </span><span style="color: #001080">text_color:</span><span style="color: #000000"> </span><span style="color: #001080">colorType</span><span style="color: #000000">,</span>
<span style="color: #000000">    </span><span style="color: #001080">type:</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #001080">UnsignedByteType</span>
<span style="color: #000000">})</span>
<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">routesType</span><span style="color: #000000"> = </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #795E26">ArrayType</span><span style="color: #000000">(</span>
<span style="color: #000000">    </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #795E26">StructType</span><span style="color: #000000">({</span>
<span style="color: #000000">        </span><span style="color: #001080">id:</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #001080">StringType</span><span style="color: #000000">,</span>
<span style="color: #000000">        </span><span style="color: #001080">attributes:</span><span style="color: #000000"> </span><span style="color: #001080">routeAttributesType</span>
<span style="color: #000000">    })</span>
<span style="color: #000000">)</span>
</code></pre>
				<a href="#converting-types-and-values-to-binary-data" id="converting-types-and-values-to-binary-data" style="color: inherit; text-decoration: none;">
					<h3>Converting types and values to binary data</h3>
				</a>
				<pre><code class="language-javascript"><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">sb</span><span style="color: #000000"> = </span><span style="color: #795E26">require</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;structure-bytes&#039;</span><span style="color: #000000">)</span>

<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">colorType</span><span style="color: #000000"> = </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #795E26">TupleType</span><span style="color: #000000">({</span>
<span style="color: #000000">    </span><span style="color: #001080">type:</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #001080">UnsignedByteType</span><span style="color: #000000">,</span>
<span style="color: #000000">    </span><span style="color: #001080">length:</span><span style="color: #000000"> </span><span style="color: #098658">3</span>
<span style="color: #000000">})</span>
<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">routeAttributesType</span><span style="color: #000000"> = </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #795E26">StructType</span><span style="color: #000000">({</span>
<span style="color: #000000">    </span><span style="color: #001080">color:</span><span style="color: #000000"> </span><span style="color: #001080">colorType</span><span style="color: #000000">,</span>
<span style="color: #000000">    </span><span style="color: #001080">description:</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #795E26">PointerType</span><span style="color: #000000">(</span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #001080">StringType</span><span style="color: #000000">),</span>
<span style="color: #000000">    </span><span style="color: #001080">direction_names:</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #795E26">PointerType</span><span style="color: #000000">(</span>
<span style="color: #000000">        </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #795E26">ArrayType</span><span style="color: #000000">(</span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #001080">StringType</span><span style="color: #000000">)</span>
<span style="color: #000000">    ),</span>
<span style="color: #000000">    </span><span style="color: #001080">long_name:</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #001080">StringType</span><span style="color: #000000">,</span>
<span style="color: #000000">    </span><span style="color: #001080">text_color:</span><span style="color: #000000"> </span><span style="color: #001080">colorType</span><span style="color: #000000">,</span>
<span style="color: #000000">    </span><span style="color: #001080">type:</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #001080">UnsignedByteType</span>
<span style="color: #000000">})</span>
<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">routesType</span><span style="color: #000000"> = </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #795E26">ArrayType</span><span style="color: #000000">(</span>
<span style="color: #000000">    </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #795E26">StructType</span><span style="color: #000000">({</span>
<span style="color: #000000">        </span><span style="color: #001080">id:</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #001080">StringType</span><span style="color: #000000">,</span>
<span style="color: #000000">        </span><span style="color: #001080">attributes:</span><span style="color: #000000"> </span><span style="color: #001080">routeAttributesType</span>
<span style="color: #000000">    })</span>
<span style="color: #000000">)</span>
<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">typeBuffer</span><span style="color: #000000"> = </span><span style="color: #001080">routesType</span><span style="color: #000000">.</span><span style="color: #795E26">toBuffer</span><span style="color: #000000">()</span>
<span style="color: #008000">// ArrayBuffer { byteLength: 92 }</span>
<span style="color: #001080">console</span><span style="color: #000000">.</span><span style="color: #795E26">log</span><span style="color: #000000">(</span><span style="color: #001080">Buffer</span><span style="color: #000000">.</span><span style="color: #795E26">from</span><span style="color: #000000">(</span><span style="color: #001080">typeBuffer</span><span style="color: #000000">))</span>
<span style="color: #008000">// &lt;Buffer 52 51 02 0a 61 74 74 72 69 62 75 74 65 73 51 06 05 63 6f 6c 6f 72 50 11 03 0b 64 65 73 63 72 69 70 74 69 6f 6e 70 41 0f 64 69 72 65 63 74 69 6f 6e 5f ... &gt;</span>

<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #795E26">toRGB</span><span style="color: #000000"> = </span><span style="color: #001080">hex</span><span style="color: #000000"> </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> [</span>
<span style="color: #000000">    </span><span style="color: #795E26">parseInt</span><span style="color: #000000">(</span><span style="color: #001080">hex</span><span style="color: #000000">.</span><span style="color: #795E26">slice</span><span style="color: #000000">(</span><span style="color: #098658">0</span><span style="color: #000000">, </span><span style="color: #098658">2</span><span style="color: #000000">), </span><span style="color: #098658">16</span><span style="color: #000000">),</span>
<span style="color: #000000">    </span><span style="color: #795E26">parseInt</span><span style="color: #000000">(</span><span style="color: #001080">hex</span><span style="color: #000000">.</span><span style="color: #795E26">slice</span><span style="color: #000000">(</span><span style="color: #098658">2</span><span style="color: #000000">, </span><span style="color: #098658">4</span><span style="color: #000000">), </span><span style="color: #098658">16</span><span style="color: #000000">),</span>
<span style="color: #000000">    </span><span style="color: #795E26">parseInt</span><span style="color: #000000">(</span><span style="color: #001080">hex</span><span style="color: #000000">.</span><span style="color: #795E26">slice</span><span style="color: #000000">(</span><span style="color: #098658">4</span><span style="color: #000000">, </span><span style="color: #098658">6</span><span style="color: #000000">), </span><span style="color: #098658">16</span><span style="color: #000000">)</span>
<span style="color: #000000">]</span>
<span style="color: #795E26">fetch</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;https://api-v3.mbta.com/routes?filter[type]=0,1&#039;</span><span style="color: #000000">)</span>
<span style="color: #000000">    .</span><span style="color: #795E26">then</span><span style="color: #000000">(</span><span style="color: #001080">res</span><span style="color: #000000"> </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> </span><span style="color: #001080">res</span><span style="color: #000000">.</span><span style="color: #795E26">json</span><span style="color: #000000">())</span>
<span style="color: #000000">    .</span><span style="color: #795E26">then</span><span style="color: #000000">(({</span><span style="color: #001080">data</span><span style="color: #000000">}) </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> {</span>
<span style="color: #000000">        </span><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">routes</span><span style="color: #000000"> = </span><span style="color: #001080">data</span><span style="color: #000000">.</span><span style="color: #795E26">map</span><span style="color: #000000">(({</span><span style="color: #001080">id</span><span style="color: #000000">, </span><span style="color: #001080">attributes</span><span style="color: #000000">}) </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> {</span>
<span style="color: #000000">            </span><span style="color: #0000FF">delete</span><span style="color: #000000"> </span><span style="color: #001080">attributes</span><span style="color: #000000">.</span><span style="color: #001080">short_name</span>
<span style="color: #000000">            </span><span style="color: #0000FF">delete</span><span style="color: #000000"> </span><span style="color: #001080">attributes</span><span style="color: #000000">.</span><span style="color: #001080">sort_order</span>
<span style="color: #000000">            </span><span style="color: #001080">attributes</span><span style="color: #000000">.</span><span style="color: #001080">color</span><span style="color: #000000"> = </span><span style="color: #795E26">toRGB</span><span style="color: #000000">(</span><span style="color: #001080">attributes</span><span style="color: #000000">.</span><span style="color: #001080">color</span><span style="color: #000000">)</span>
<span style="color: #000000">            </span><span style="color: #001080">attributes</span><span style="color: #000000">.</span><span style="color: #001080">text_color</span><span style="color: #000000"> = </span><span style="color: #795E26">toRGB</span><span style="color: #000000">(</span><span style="color: #001080">attributes</span><span style="color: #000000">.</span><span style="color: #001080">text_color</span><span style="color: #000000">)</span>
<span style="color: #000000">            </span><span style="color: #AF00DB">return</span><span style="color: #000000"> {</span><span style="color: #001080">id</span><span style="color: #000000">, </span><span style="color: #001080">attributes</span><span style="color: #000000">}</span>
<span style="color: #000000">        })</span>
<span style="color: #000000">        </span><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">valueBuffer</span><span style="color: #000000"> = </span><span style="color: #001080">routesType</span><span style="color: #000000">.</span><span style="color: #795E26">valueBuffer</span><span style="color: #000000">(</span><span style="color: #001080">routes</span><span style="color: #000000">)</span>
<span style="color: #000000">        </span><span style="color: #008000">// ArrayBuffer { byteLength: 306 }</span>
<span style="color: #000000">        </span><span style="color: #008000">// (for comparison, JSON.stringify(routes).length == 1498)</span>
<span style="color: #000000">    })</span>
</code></pre>
				<a href="#reading-from-type-and-value-buffers" id="reading-from-type-and-value-buffers" style="color: inherit; text-decoration: none;">
					<h3>Reading from type and value buffers</h3>
				</a>
				<pre><code class="language-javascript"><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">sb</span><span style="color: #000000"> = </span><span style="color: #795E26">require</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;structure-bytes&#039;</span><span style="color: #000000">)</span>

<span style="color: #008000">// Buffer obtained somehow</span>
<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">typeBuffer</span><span style="color: #000000"> = </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #267F99">Uint8Array</span><span style="color: #000000">([</span><span style="color: #098658">0x50</span><span style="color: #000000">, </span><span style="color: #098658">0x11</span><span style="color: #000000">, </span><span style="color: #098658">0x03</span><span style="color: #000000">]).</span><span style="color: #001080">buffer</span>
<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">type</span><span style="color: #000000"> = </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #001080">r</span><span style="color: #000000">.</span><span style="color: #795E26">type</span><span style="color: #000000">(</span><span style="color: #001080">typeBuffer</span><span style="color: #000000">)</span>
<span style="color: #001080">console</span><span style="color: #000000">.</span><span style="color: #795E26">log</span><span style="color: #000000">(</span><span style="color: #001080">type</span><span style="color: #000000">)</span>
<span style="color: #008000">// TupleType { type: UnsignedByteType {}, length: 3 }</span>

<span style="color: #008000">// Buffer obtained somehow</span>
<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">valueBuffer</span><span style="color: #000000"> = </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #267F99">Uint8Array</span><span style="color: #000000">([</span><span style="color: #098658">0x00</span><span style="color: #000000">, </span><span style="color: #098658">0x80</span><span style="color: #000000">, </span><span style="color: #098658">0xFF</span><span style="color: #000000">]).</span><span style="color: #001080">buffer</span>
<span style="color: #001080">console</span><span style="color: #000000">.</span><span style="color: #795E26">log</span><span style="color: #000000">(</span><span style="color: #001080">type</span><span style="color: #000000">.</span><span style="color: #795E26">readValue</span><span style="color: #000000">(</span><span style="color: #001080">valueBuffer</span><span style="color: #000000">))</span>
<span style="color: #008000">// [ 0, 128, 255 ]</span>
</code></pre>
				<a href="#file-io" id="file-io" style="color: inherit; text-decoration: none;">
					<h3>File I/O</h3>
				</a>
				<p>The I/O functions are implemented with callbacks, but can all be used with <a href="https://nodejs.org/api/util.html#util_util_promisify_original"><code>util.promisify()</code></a> if you prefer to use <code>Promise</code>s instead.
				See the documentation for examples.</p>
				<p>I recommend the file extensions <code>.sbt</code> for a serialized type, <code>.sbv</code> for a serialized value, and <code>.sbtv</code> for a serialized type and value.</p>
				<pre><code class="language-javascript"><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">fs</span><span style="color: #000000"> = </span><span style="color: #795E26">require</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;fs&#039;</span><span style="color: #000000">)</span>
<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">sb</span><span style="color: #000000"> = </span><span style="color: #795E26">require</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;structure-bytes&#039;</span><span style="color: #000000">)</span>

<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">type</span><span style="color: #000000"> = </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #795E26">EnumType</span><span style="color: #000000">({</span>
<span style="color: #000000">    </span><span style="color: #001080">type:</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #001080">StringType</span><span style="color: #000000">,</span>
<span style="color: #000000">    </span><span style="color: #001080">values:</span><span style="color: #000000"> [</span>
<span style="color: #000000">        </span><span style="color: #A31515">&#039;ON_TIME&#039;</span><span style="color: #000000">,</span>
<span style="color: #000000">        </span><span style="color: #A31515">&#039;LATE&#039;</span><span style="color: #000000">,</span>
<span style="color: #000000">        </span><span style="color: #A31515">&#039;CANCELLED&#039;</span><span style="color: #000000">,</span>
<span style="color: #000000">        </span><span style="color: #A31515">&#039;UNKNOWN&#039;</span>
<span style="color: #000000">    ]</span>
<span style="color: #000000">})</span>
<span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #795E26">writeType</span><span style="color: #000000">({</span>
<span style="color: #000000">    </span><span style="color: #001080">type</span><span style="color: #000000">,</span>
<span style="color: #000000">    </span><span style="color: #001080">outStream:</span><span style="color: #000000"> </span><span style="color: #001080">fs</span><span style="color: #000000">.</span><span style="color: #795E26">createWriteStream</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;status.sbt&#039;</span><span style="color: #000000">)</span>
<span style="color: #000000">}, </span><span style="color: #001080">err</span><span style="color: #000000"> </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> {</span>
<span style="color: #000000">    </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #795E26">readType</span><span style="color: #000000">(</span><span style="color: #001080">fs</span><span style="color: #000000">.</span><span style="color: #795E26">createReadStream</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;status.sbt&#039;</span><span style="color: #000000">), (</span><span style="color: #001080">err</span><span style="color: #000000">, </span><span style="color: #001080">readType</span><span style="color: #000000">) </span><span style="color: #0000FF">=&gt;</span>
<span style="color: #000000">        </span><span style="color: #001080">console</span><span style="color: #000000">.</span><span style="color: #795E26">log</span><span style="color: #000000">(</span><span style="color: #001080">readType</span><span style="color: #000000">)</span>
<span style="color: #000000">        </span><span style="color: #008000">/*</span>
<span style="color: #008000">        EnumType {</span>
<span style="color: #008000">            type: StringType {},</span>
<span style="color: #008000">            values: [ &#039;ON_TIME&#039;, &#039;LATE&#039;, &#039;CANCELLED&#039;, &#039;UNKNOWN&#039; ] }</span>
<span style="color: #008000">        */</span>
<span style="color: #000000">    )</span>
<span style="color: #000000">})</span>

<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">value</span><span style="color: #000000"> = </span><span style="color: #A31515">&#039;CANCELLED&#039;</span>
<span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #795E26">writeValue</span><span style="color: #000000">({</span>
<span style="color: #000000">    </span><span style="color: #001080">type</span><span style="color: #000000">,</span>
<span style="color: #000000">    </span><span style="color: #001080">value</span><span style="color: #000000">,</span>
<span style="color: #000000">    </span><span style="color: #001080">outStream:</span><span style="color: #000000"> </span><span style="color: #001080">fs</span><span style="color: #000000">.</span><span style="color: #795E26">createWriteStream</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;status.sbv&#039;</span><span style="color: #000000">)</span>
<span style="color: #000000">}, </span><span style="color: #001080">err</span><span style="color: #000000"> </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> {</span>
<span style="color: #000000">    </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #795E26">readValue</span><span style="color: #000000">({</span>
<span style="color: #000000">        </span><span style="color: #001080">type</span><span style="color: #000000">,</span>
<span style="color: #000000">        </span><span style="color: #001080">inStream:</span><span style="color: #000000"> </span><span style="color: #001080">fs</span><span style="color: #000000">.</span><span style="color: #795E26">createReadStream</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;status.sbv&#039;</span><span style="color: #000000">)</span>
<span style="color: #000000">    }, (</span><span style="color: #001080">err</span><span style="color: #000000">, </span><span style="color: #001080">value</span><span style="color: #000000">) </span><span style="color: #0000FF">=&gt;</span>
<span style="color: #000000">        </span><span style="color: #001080">console</span><span style="color: #000000">.</span><span style="color: #795E26">log</span><span style="color: #000000">(</span><span style="color: #001080">value</span><span style="color: #000000">)</span>
<span style="color: #000000">        </span><span style="color: #008000">// &#039;CANCELLED&#039;</span>
<span style="color: #000000">    )</span>
<span style="color: #000000">})</span>

<span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #795E26">writeTypeAndValue</span><span style="color: #000000">({</span>
<span style="color: #000000">    </span><span style="color: #001080">type</span><span style="color: #000000">,</span>
<span style="color: #000000">    </span><span style="color: #001080">value</span><span style="color: #000000">,</span>
<span style="color: #000000">    </span><span style="color: #001080">outStream:</span><span style="color: #000000"> </span><span style="color: #001080">fs</span><span style="color: #000000">.</span><span style="color: #795E26">createWriteStream</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;status.sbtv&#039;</span><span style="color: #000000">)</span>
<span style="color: #000000">}, </span><span style="color: #001080">err</span><span style="color: #000000"> </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> {</span>
<span style="color: #000000">    </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #795E26">readTypeAndValue</span><span style="color: #000000">(</span><span style="color: #001080">fs</span><span style="color: #000000">.</span><span style="color: #795E26">createReadStream</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;status.sbtv&#039;</span><span style="color: #000000">), (</span><span style="color: #001080">err</span><span style="color: #000000">, </span><span style="color: #001080">type</span><span style="color: #000000">, </span><span style="color: #001080">value</span><span style="color: #000000">) </span><span style="color: #0000FF">=&gt;</span>
<span style="color: #000000">        </span><span style="color: #001080">console</span><span style="color: #000000">.</span><span style="color: #795E26">log</span><span style="color: #000000">(</span><span style="color: #001080">value</span><span style="color: #000000">)</span>
<span style="color: #000000">        </span><span style="color: #008000">// &#039;CANCELLED&#039;</span>
<span style="color: #000000">    )</span>
<span style="color: #000000">})</span>
</code></pre>
				<a href="#http-get-value" id="http-get-value" style="color: inherit; text-decoration: none;">
					<h3>HTTP GET value</h3>
				</a>
				<p>Server-side:</p>
				<pre><code class="language-javascript"><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">http</span><span style="color: #000000"> = </span><span style="color: #795E26">require</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;http&#039;</span><span style="color: #000000">)</span>
<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">sb</span><span style="color: #000000"> = </span><span style="color: #795E26">require</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;structure-bytes&#039;</span><span style="color: #000000">)</span>

<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">type</span><span style="color: #000000"> = </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #001080">DateType</span>
<span style="color: #001080">http</span><span style="color: #000000">.</span><span style="color: #795E26">createServer</span><span style="color: #000000">((</span><span style="color: #001080">req</span><span style="color: #000000">, </span><span style="color: #001080">res</span><span style="color: #000000">) </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> {</span>
<span style="color: #000000">    </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #795E26">httpRespond</span><span style="color: #000000">({</span><span style="color: #001080">req</span><span style="color: #000000">, </span><span style="color: #001080">res</span><span style="color: #000000">, </span><span style="color: #001080">type</span><span style="color: #000000">, </span><span style="color: #001080">value:</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #267F99">Date</span><span style="color: #000000">}, </span><span style="color: #001080">err</span><span style="color: #000000"> </span><span style="color: #0000FF">=&gt;</span>
<span style="color: #000000">        </span><span style="color: #001080">console</span><span style="color: #000000">.</span><span style="color: #795E26">log</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;Responded&#039;</span><span style="color: #000000">)</span>
<span style="color: #000000">    )</span>
<span style="color: #000000">}).</span><span style="color: #795E26">listen</span><span style="color: #000000">(</span><span style="color: #098658">80</span><span style="color: #000000">)</span>
</code></pre>
				<p>Client-side:</p>
				<pre><code class="language-html"><span style="color: #800000">&lt;script</span><span style="color: #000000FF"> </span><span style="color: #FF0000">src</span><span style="color: #000000FF"> = </span><span style="color: #0000FF">&#039;/structure-bytes/compiled/download.js&#039;</span><span style="color: #800000">&gt;&lt;/script&gt;</span>
<span style="color: #800000">&lt;script&gt;</span>
<span style="color: #000000FF">    </span><span style="color: #008000">// &#039;date&#039; specifies the name of the type being transferred so it can be cached for future requests</span>
<span style="color: #000000FF">    </span><span style="color: #001080">sb</span><span style="color: #000000FF">.</span><span style="color: #795E26">download</span><span style="color: #000000FF">({</span>
<span style="color: #000000FF">        </span><span style="color: #001080">name:</span><span style="color: #000000FF"> </span><span style="color: #A31515">&#039;date&#039;</span><span style="color: #000000FF">,</span>
<span style="color: #000000FF">        </span><span style="color: #001080">url:</span><span style="color: #000000FF"> </span><span style="color: #A31515">&#039;/&#039;</span><span style="color: #000000FF">,</span>
<span style="color: #000000FF">        </span><span style="color: #001080">options:</span><span style="color: #000000FF"> {} </span><span style="color: #008000">// optional options to pass to fetch() (e.g. cookies, headers, etc.)</span>
<span style="color: #000000FF">    })</span>
<span style="color: #000000FF">        .</span><span style="color: #795E26">then</span><span style="color: #000000FF">(</span><span style="color: #001080">value</span><span style="color: #000000FF"> </span><span style="color: #0000FF">=&gt;</span>
<span style="color: #000000FF">            </span><span style="color: #001080">console</span><span style="color: #000000FF">.</span><span style="color: #795E26">log</span><span style="color: #000000FF">(</span><span style="color: #001080">value</span><span style="color: #000000FF">.</span><span style="color: #795E26">getFullYear</span><span style="color: #000000FF">())</span>
<span style="color: #000000FF">            </span><span style="color: #008000">// 2017</span>
<span style="color: #000000FF">        )</span>
<span style="color: #800000">&lt;/script&gt;</span>
</code></pre>
				<a href="#http-post-value" id="http-post-value" style="color: inherit; text-decoration: none;">
					<h3>HTTP POST value</h3>
				</a>
				<p>Server-side:</p>
				<pre><code class="language-javascript"><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">http</span><span style="color: #000000"> = </span><span style="color: #795E26">require</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;http&#039;</span><span style="color: #000000">)</span>
<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">sb</span><span style="color: #000000"> = </span><span style="color: #795E26">require</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;structure-bytes&#039;</span><span style="color: #000000">)</span>

<span style="color: #001080">http</span><span style="color: #000000">.</span><span style="color: #795E26">createServer</span><span style="color: #000000">((</span><span style="color: #001080">req</span><span style="color: #000000">, </span><span style="color: #001080">res</span><span style="color: #000000">) </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> {</span>
<span style="color: #000000">    </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #795E26">readValue</span><span style="color: #000000">({</span><span style="color: #001080">type:</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #001080">FlexUnsignedIntType</span><span style="color: #000000">, </span><span style="color: #001080">inStream:</span><span style="color: #000000"> </span><span style="color: #001080">req</span><span style="color: #000000">}, (</span><span style="color: #001080">err</span><span style="color: #000000">, </span><span style="color: #001080">value</span><span style="color: #000000">) </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> {</span>
<span style="color: #000000">        </span><span style="color: #001080">res</span><span style="color: #000000">.</span><span style="color: #795E26">end</span><span style="color: #000000">(</span><span style="color: #267F99">String</span><span style="color: #000000">(</span><span style="color: #001080">value</span><span style="color: #000000">))</span>
<span style="color: #000000">    })</span>
<span style="color: #000000">}).</span><span style="color: #795E26">listen</span><span style="color: #000000">(</span><span style="color: #098658">80</span><span style="color: #000000">)</span>
</code></pre>
				<p>Client-side:</p>
				<pre><code class="language-html"><span style="color: #800000">&lt;script</span><span style="color: #000000FF"> </span><span style="color: #FF0000">src</span><span style="color: #000000FF"> = </span><span style="color: #0000FF">&#039;/structure-bytes/compiled/upload.js&#039;</span><span style="color: #800000">&gt;&lt;/script&gt;</span>
<span style="color: #800000">&lt;button</span><span style="color: #000000"> </span><span style="color: #FF0000">onclick</span><span style="color: #000000"> = </span><span style="color: #0000FF">&#039;</span><span style="color: #795E26">upload</span><span style="color: #0000FF">()&#039;</span><span style="color: #800000">&gt;</span><span style="color: #000000">Click me</span><span style="color: #800000">&lt;/button&gt;</span>
<span style="color: #800000">&lt;script&gt;</span>
<span style="color: #000000FF">    </span><span style="color: #0000FF">let</span><span style="color: #000000FF"> </span><span style="color: #001080">clickCount</span><span style="color: #000000FF"> </span><span style="color: #000000">=</span><span style="color: #000000FF"> </span><span style="color: #098658">0</span>
<span style="color: #000000FF">    </span><span style="color: #0000FF">function</span><span style="color: #000000FF"> </span><span style="color: #795E26">upload</span><span style="color: #000000FF">() {</span>
<span style="color: #000000FF">        </span><span style="color: #001080">clickCount</span><span style="color: #000000">++</span>
<span style="color: #000000FF">        </span><span style="color: #001080">sb</span><span style="color: #000000FF">.</span><span style="color: #795E26">upload</span><span style="color: #000000FF">({</span>
<span style="color: #000000FF">            </span><span style="color: #001080">type:</span><span style="color: #000000FF"> </span><span style="color: #0000FF">new</span><span style="color: #000000FF"> </span><span style="color: #001080">sb</span><span style="color: #000000FF">.</span><span style="color: #001080">FlexUnsignedIntType</span><span style="color: #000000FF">,</span>
<span style="color: #000000FF">            </span><span style="color: #001080">value:</span><span style="color: #000000FF"> </span><span style="color: #001080">clickCount</span><span style="color: #000000FF">,</span>
<span style="color: #000000FF">            </span><span style="color: #001080">url:</span><span style="color: #000000FF"> </span><span style="color: #A31515">&#039;/click&#039;</span><span style="color: #000000FF">,</span>
<span style="color: #000000FF">            </span><span style="color: #001080">options:</span><span style="color: #000000FF"> {</span><span style="color: #001080">method:</span><span style="color: #000000FF"> </span><span style="color: #A31515">&#039;POST&#039;</span><span style="color: #000000FF">} </span><span style="color: #008000">// options to pass to fetch(); method &#039;POST&#039; is required</span>
<span style="color: #000000FF">        })</span>
<span style="color: #000000FF">            .</span><span style="color: #795E26">then</span><span style="color: #000000FF">(</span><span style="color: #001080">response</span><span style="color: #000000FF"> </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000FF"> </span><span style="color: #001080">response</span><span style="color: #000000FF">.</span><span style="color: #795E26">text</span><span style="color: #000000FF">())</span>
<span style="color: #000000FF">            .</span><span style="color: #795E26">then</span><span style="color: #000000FF">(</span><span style="color: #001080">alert</span><span style="color: #000000FF">)</span>
<span style="color: #000000FF">    }</span>
<span style="color: #800000">&lt;/script&gt;</span>
</code></pre>
				<a href="#using-with-typescript" id="using-with-typescript" style="color: inherit; text-decoration: none;">
					<h2>Using with TypeScript</h2>
				</a>
				<p>The entire project is written in TypeScript and declaration files are automatically generated. That means that if you are using TypeScript, the compiler can automatically infer the type of the various values exported from <code>structure-bytes</code>. To import the package, use:</p>
				<pre><code class="language-javascript"><span style="color: #AF00DB">import</span><span style="color: #000000"> </span><span style="color: #0000FF">*</span><span style="color: #000000"> </span><span style="color: #AF00DB">as</span><span style="color: #000000"> </span><span style="color: #001080">sb</span><span style="color: #000000"> </span><span style="color: #AF00DB">from</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;structure-bytes&#039;</span>
</code></pre>
				<p>The typings allow the compiler to automatically infer what types of values a <code>Type</code> can serialize. For example:</p>
				<pre><code class="language-javascript"><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">type</span><span style="color: #000000"> = </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #795E26">StructType</span><span style="color: #000000">({</span>
<span style="color: #000000">    </span><span style="color: #001080">abc:</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #001080">DoubleType</span><span style="color: #000000">,</span>
<span style="color: #000000">    </span><span style="color: #001080">def:</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #795E26">MapType</span><span style="color: #000000">(</span>
<span style="color: #000000">        </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #001080">StringType</span><span style="color: #000000">,</span>
<span style="color: #000000">        </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #001080">DayType</span>
<span style="color: #000000">    )</span>
<span style="color: #000000">})</span>
<span style="color: #001080">type</span><span style="color: #000000">.</span><span style="color: #795E26">valueBuffer</span><span style="color: #000000">(</span><span style="color: #008000">/*...*/</span><span style="color: #000000">)</span>
<span style="color: #008000">/*</span>
<span style="color: #008000">If you hover over &quot;valueBuffer&quot;, you can see</span>
<span style="color: #008000">that it requires the value to be of type:</span>
<span style="color: #008000">{ abc: number | string, def: Map&lt;string, Date&gt; }</span>
<span style="color: #008000">*/</span>
</code></pre>
				<p>You can also add explicit <code>VALUE</code> generics to make the compiler check that your <code>Type</code> serializes the correct types of values.
					Many non-primitive types (e.g. <code>ArrayType</code>, <code>MapType</code>, <code>StructType</code>) can take either one or two generics.
					The first, <code>VALUE</code>, specifies the type of values the type can serialize.
					The second, <code>READ_VALUE</code>, specifies the type of values the type will deserialize and defaults to <code>VALUE</code> if omitted.
					<code>READ_VALUE</code> must extend <code>VALUE</code>.
				Generally the two generics are the same, except in the case of numeric types (which write <code>number | string</code> but read <code>number</code>) and <code>OptionalType</code> (which writes <code>E | null | undefined</code> but reads <code>E | null</code>).</p>
				<p>With <code>StructType</code>:</p>
				<pre><code class="language-typescript"><span style="color: #0000FF">class</span><span style="color: #000000"> </span><span style="color: #267F99">Car</span><span style="color: #000000"> {</span>
<span style="color: #000000">    </span><span style="color: #0000FF">constructor</span><span style="color: #000000">(</span>
<span style="color: #000000">        </span><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #001080">make</span><span style="color: #000000">: </span><span style="color: #267F99">string</span><span style="color: #000000">,</span>
<span style="color: #000000">        </span><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #001080">model</span><span style="color: #000000">: </span><span style="color: #267F99">string</span><span style="color: #000000">,</span>
<span style="color: #000000">        </span><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #001080">year</span><span style="color: #000000">: </span><span style="color: #267F99">number</span>
<span style="color: #000000">    ) {}</span>
<span style="color: #000000">}</span>
<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">carType</span><span style="color: #000000"> = </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #795E26">StructType</span><span style="color: #000000">&lt;</span><span style="color: #267F99">Car</span><span style="color: #000000">&gt;({</span>
<span style="color: #000000">    </span><span style="color: #001080">make:</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #001080">StringType</span><span style="color: #000000">,</span>
<span style="color: #000000">    </span><span style="color: #001080">model:</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #001080">StringType</span><span style="color: #000000">,</span>
<span style="color: #000000">    </span><span style="color: #001080">year:</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #001080">UnsignedShortType</span>
<span style="color: #000000">})</span>
<span style="color: #008000">// The compiler would have complained if one of the fields were missing</span>
<span style="color: #008000">// or one of the field&#039;s types didn&#039;t match the type of the field&#039;s values,</span>
<span style="color: #008000">// e.g. &quot;make: new sb.BooleanType&quot;</span>
</code></pre>
				<p>If you have transient fields (i.e. they shouldn&#39;t be serialized), you can create a separate interface for the fields that should be serialized:</p>
				<pre><code class="language-typescript"><span style="color: #0000FF">interface</span><span style="color: #000000"> </span><span style="color: #267F99">SerializedCar</span><span style="color: #000000"> {</span>
<span style="color: #000000">    </span><span style="color: #001080">make</span><span style="color: #000000">: </span><span style="color: #267F99">string</span>
<span style="color: #000000">    </span><span style="color: #001080">model</span><span style="color: #000000">: </span><span style="color: #267F99">string</span>
<span style="color: #000000">    </span><span style="color: #001080">year</span><span style="color: #000000">: </span><span style="color: #267F99">number</span>
<span style="color: #000000">}</span>
<span style="color: #0000FF">class</span><span style="color: #000000"> </span><span style="color: #267F99">Car</span><span style="color: #000000"> </span><span style="color: #0000FF">implements</span><span style="color: #000000"> </span><span style="color: #267F99">SerializedCar</span><span style="color: #000000"> {</span>
<span style="color: #000000">    </span><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #001080">id</span><span style="color: #000000">: </span><span style="color: #267F99">number</span><span style="color: #000000"> </span><span style="color: #008000">// transient field</span>
<span style="color: #000000">    </span><span style="color: #0000FF">constructor</span><span style="color: #000000">(</span><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #001080">make</span><span style="color: #000000">: </span><span style="color: #267F99">string</span><span style="color: #000000">, </span><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #001080">model</span><span style="color: #000000">: </span><span style="color: #267F99">string</span><span style="color: #000000">, </span><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #001080">year</span><span style="color: #000000">: </span><span style="color: #267F99">number</span><span style="color: #000000">) {</span>
<span style="color: #000000">        </span><span style="color: #0000FF">this</span><span style="color: #000000">.</span><span style="color: #001080">id</span><span style="color: #000000"> = </span><span style="color: #267F99">Math</span><span style="color: #000000">.</span><span style="color: #795E26">floor</span><span style="color: #000000">(</span><span style="color: #267F99">Math</span><span style="color: #000000">.</span><span style="color: #795E26">random</span><span style="color: #000000">() * </span><span style="color: #098658">1e6</span><span style="color: #000000">)</span>
<span style="color: #000000">    }</span>
<span style="color: #000000">}</span>
<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">carType</span><span style="color: #000000"> = </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #795E26">StructType</span><span style="color: #000000">&lt;</span><span style="color: #267F99">SerializedCar</span><span style="color: #000000">&gt;({</span>
<span style="color: #000000">    </span><span style="color: #001080">make:</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #001080">StringType</span><span style="color: #000000">,</span>
<span style="color: #000000">    </span><span style="color: #001080">model:</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #001080">StringType</span><span style="color: #000000">,</span>
<span style="color: #000000">    </span><span style="color: #001080">year:</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #001080">UnsignedShortType</span>
<span style="color: #000000">})</span>
</code></pre>
				<p>With <code>ChoiceType</code>, you can let the type be inferred automatically if each of the possible types writes the same type of values:</p>
				<pre><code class="language-javascript"><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">choiceType</span><span style="color: #000000"> = </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #795E26">ChoiceType</span><span style="color: #000000">([ </span><span style="color: #008000">// Type&lt;number | string, number&gt;</span>
<span style="color: #000000">    </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #001080">ByteType</span><span style="color: #000000">,</span>
<span style="color: #000000">    </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #001080">ShortType</span><span style="color: #000000">,</span>
<span style="color: #000000">    </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #001080">IntType</span><span style="color: #000000">,</span>
<span style="color: #000000">    </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #001080">DoubleType</span>
<span style="color: #000000">])</span>
</code></pre>
				<p>However, if the value types are not the same, TypeScript will complain about them not matching, and you should express the union type explicitly:</p>
				<pre><code class="language-typescript"><span style="color: #0000FF">interface</span><span style="color: #000000"> </span><span style="color: #267F99">RGB</span><span style="color: #000000"> {</span>
<span style="color: #000000">    </span><span style="color: #001080">r</span><span style="color: #000000">: </span><span style="color: #267F99">number</span>
<span style="color: #000000">    </span><span style="color: #001080">g</span><span style="color: #000000">: </span><span style="color: #267F99">number</span>
<span style="color: #000000">    </span><span style="color: #001080">b</span><span style="color: #000000">: </span><span style="color: #267F99">number</span>
<span style="color: #000000">}</span>
<span style="color: #0000FF">interface</span><span style="color: #000000"> </span><span style="color: #267F99">HSV</span><span style="color: #000000"> {</span>
<span style="color: #000000">    </span><span style="color: #001080">h</span><span style="color: #000000">: </span><span style="color: #267F99">number</span>
<span style="color: #000000">    </span><span style="color: #001080">s</span><span style="color: #000000">: </span><span style="color: #267F99">number</span>
<span style="color: #000000">    </span><span style="color: #001080">v</span><span style="color: #000000">: </span><span style="color: #267F99">number</span>
<span style="color: #000000">}</span>
<span style="color: #0000FF">type</span><span style="color: #000000"> </span><span style="color: #267F99">CSSColor</span><span style="color: #000000"> = </span><span style="color: #267F99">string</span>

<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">choiceType</span><span style="color: #000000"> = </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #795E26">ChoiceType</span><span style="color: #000000">&lt;</span><span style="color: #267F99">RGB</span><span style="color: #000000"> | </span><span style="color: #267F99">HSV</span><span style="color: #000000"> | </span><span style="color: #267F99">CSSColor</span><span style="color: #000000">&gt;([</span>
<span style="color: #000000">    </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #795E26">StructType</span><span style="color: #000000">&lt;</span><span style="color: #267F99">RGB</span><span style="color: #000000">&gt;({</span>
<span style="color: #000000">        </span><span style="color: #001080">r:</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #001080">FloatType</span><span style="color: #000000">,</span>
<span style="color: #000000">        </span><span style="color: #001080">g:</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #001080">FloatType</span><span style="color: #000000">,</span>
<span style="color: #000000">        </span><span style="color: #001080">b:</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #001080">FloatType</span>
<span style="color: #000000">    }),</span>
<span style="color: #000000">    </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #795E26">StructType</span><span style="color: #000000">&lt;</span><span style="color: #267F99">HSV</span><span style="color: #000000">&gt;({</span>
<span style="color: #000000">        </span><span style="color: #001080">h:</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #001080">FloatType</span><span style="color: #000000">,</span>
<span style="color: #000000">        </span><span style="color: #001080">s:</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #001080">FloatType</span><span style="color: #000000">,</span>
<span style="color: #000000">        </span><span style="color: #001080">v:</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #001080">FloatType</span>
<span style="color: #000000">    }),</span>
<span style="color: #000000">    </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #001080">StringType</span>
<span style="color: #000000">])</span>
</code></pre>
				<p>A <code>RecursiveType</code> has no way to infer its value type, so you should always provide the <code>VALUE</code> generic:</p>
				<pre><code class="language-typescript"><span style="color: #0000FF">interface</span><span style="color: #000000"> </span><span style="color: #267F99">Cons</span><span style="color: #000000">&lt;</span><span style="color: #267F99">A</span><span style="color: #000000">&gt; {</span>
<span style="color: #000000">    </span><span style="color: #001080">head</span><span style="color: #000000">: </span><span style="color: #267F99">A</span>
<span style="color: #000000">    </span><span style="color: #001080">tail</span><span style="color: #000000">: </span><span style="color: #267F99">List</span><span style="color: #000000">&lt;</span><span style="color: #267F99">A</span><span style="color: #000000">&gt;</span>
<span style="color: #000000">}</span>
<span style="color: #0000FF">interface</span><span style="color: #000000"> </span><span style="color: #267F99">List</span><span style="color: #000000">&lt;</span><span style="color: #267F99">A</span><span style="color: #000000">&gt; {</span>
<span style="color: #000000">    </span><span style="color: #001080">list</span><span style="color: #000000">: </span><span style="color: #267F99">Cons</span><span style="color: #000000">&lt;</span><span style="color: #267F99">A</span><span style="color: #000000">&gt; | </span><span style="color: #267F99">null</span><span style="color: #000000"> </span><span style="color: #008000">// null for empty list</span>
<span style="color: #000000">}</span>

<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">recursiveType</span><span style="color: #000000"> = </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #795E26">RecursiveType</span><span style="color: #000000">&lt;</span><span style="color: #267F99">List</span><span style="color: #000000">&lt;</span><span style="color: #267F99">string</span><span style="color: #000000">&gt;&gt;(</span><span style="color: #A31515">&#039;linked-list&#039;</span><span style="color: #000000">)</span>
<span style="color: #001080">recursiveType</span><span style="color: #000000">.</span><span style="color: #795E26">setType</span><span style="color: #000000">(</span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #795E26">StructType</span><span style="color: #000000">&lt;</span><span style="color: #267F99">List</span><span style="color: #000000">&lt;</span><span style="color: #267F99">string</span><span style="color: #000000">&gt;&gt;({</span>
<span style="color: #000000">    </span><span style="color: #001080">list:</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #795E26">OptionalType</span><span style="color: #000000">(</span>
<span style="color: #000000">        </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #795E26">StructType</span><span style="color: #000000">&lt;</span><span style="color: #267F99">Cons</span><span style="color: #000000">&lt;</span><span style="color: #267F99">string</span><span style="color: #000000">&gt;&gt;({</span>
<span style="color: #000000">            </span><span style="color: #001080">head:</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #001080">StringType</span><span style="color: #000000">,</span>
<span style="color: #000000">            </span><span style="color: #001080">tail:</span><span style="color: #000000"> </span><span style="color: #001080">recursiveType</span>
<span style="color: #000000">        })</span>
<span style="color: #000000">    )</span>
<span style="color: #000000">}))</span>
<span style="color: #001080">recursiveType</span><span style="color: #000000">.</span><span style="color: #795E26">valueBuffer</span><span style="color: #000000">({</span>
<span style="color: #000000">    </span><span style="color: #001080">list:</span><span style="color: #000000"> {</span>
<span style="color: #000000">        </span><span style="color: #001080">head:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;1&#039;</span><span style="color: #000000">,</span>
<span style="color: #000000">        </span><span style="color: #001080">tail:</span><span style="color: #000000"> {</span>
<span style="color: #000000">            </span><span style="color: #001080">list:</span><span style="color: #000000"> {</span>
<span style="color: #000000">                </span><span style="color: #001080">head:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;2&#039;</span><span style="color: #000000">,</span>
<span style="color: #000000">                </span><span style="color: #001080">tail:</span><span style="color: #000000"> {</span><span style="color: #001080">list:</span><span style="color: #000000"> </span><span style="color: #0000FF">null</span><span style="color: #000000">}</span>
<span style="color: #000000">            }</span>
<span style="color: #000000">        }</span>
<span style="color: #000000">    }</span>
<span style="color: #000000">})</span>
</code></pre>
				<p>When reading types from buffers and streams, they will be of type <code>Type&lt;any&gt;</code>.
				You should specify their value types before using them to write values:</p>
				<pre><code class="language-typescript"><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">booleanType</span><span style="color: #000000"> = </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #001080">BooleanType</span>
<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">readType</span><span style="color: #000000"> = </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #001080">r</span><span style="color: #000000">.</span><span style="color: #795E26">type</span><span style="color: #000000">(</span><span style="color: #001080">booleanType</span><span style="color: #000000">.</span><span style="color: #795E26">toBuffer</span><span style="color: #000000">()) </span><span style="color: #008000">// Type&lt;any&gt;</span>
<span style="color: #008000">// Will throw a runtime error</span>
<span style="color: #001080">readType</span><span style="color: #000000">.</span><span style="color: #795E26">valueBuffer</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;abc&#039;</span><span style="color: #000000">)</span>

<span style="color: #008000">//vs.</span>

<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">castReadType</span><span style="color: #000000">: </span><span style="color: #267F99">sb</span><span style="color: #000000">.</span><span style="color: #267F99">Type</span><span style="color: #000000">&lt;</span><span style="color: #267F99">boolean</span><span style="color: #000000">&gt; = </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #001080">r</span><span style="color: #000000">.</span><span style="color: #795E26">type</span><span style="color: #000000">(</span><span style="color: #001080">booleanType</span><span style="color: #000000">.</span><span style="color: #795E26">toBuffer</span><span style="color: #000000">())</span>
<span style="color: #008000">// Will throw a compiler error</span>
<span style="color: #001080">castReadType</span><span style="color: #000000">.</span><span style="color: #795E26">valueBuffer</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;abc&#039;</span><span style="color: #000000">)</span>
</code></pre>
				<p>It may also sometimes be useful to be more specific about what types of values you want to be able to serialize.
				For example, if you want to serialize integer values that will always be represented as numbers (and never in string form), you can force the compiler to error out if you try to serialize a string value with the following:</p>
				<pre><code class="language-typescript"><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">intType</span><span style="color: #000000">: </span><span style="color: #267F99">sb</span><span style="color: #000000">.</span><span style="color: #267F99">Type</span><span style="color: #000000">&lt;</span><span style="color: #267F99">number</span><span style="color: #000000">&gt; = </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #001080">IntType</span>
<span style="color: #008000">// Now this is valid:</span>
<span style="color: #001080">intType</span><span style="color: #000000">.</span><span style="color: #795E26">valueBuffer</span><span style="color: #000000">(</span><span style="color: #098658">100</span><span style="color: #000000">)</span>
<span style="color: #008000">// But this is not, even though it would be if you omitted the type annotation on intType:</span>
<span style="color: #001080">intType</span><span style="color: #000000">.</span><span style="color: #795E26">valueBuffer</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;100&#039;</span><span style="color: #000000">)</span>
</code></pre>
				<a href="#binary-formats" id="binary-formats" style="color: inherit; text-decoration: none;">
					<h2>Binary formats</h2>
				</a>
				<p>In the following definitions, <code>flexInt</code> means a variable-length unsigned integer with the following format, where <code>X</code> represents either <code>0</code> or <code>1</code>:</p>
				<ul>
					<li><code>[0b0XXXXXXX]</code> stores values from <code>0</code> to <code>2**7 - 1</code> in their unsigned 7-bit integer representations</li>
					<li><code>[0b10XXXXXX, 0bXXXXXXXX]</code> stores values from <code>2**7</code> to <code>2**7 + 2**14 - 1</code>, where a value <code>x</code> is encoded into the unsigned 14-bit representation of <code>x - 2**7</code></li>
					<li><code>[0b110XXXXX, 0bXXXXXXXX, 0bXXXXXXXX]</code> stores values from <code>2**7 + 2**14</code> to <code>2**7 + 2**14 + 2**21 - 1</code>, where a value <code>x</code> is encoded into the unsigned 21-bit representation of <code>x - (2**7 + 2**14)</code></li>
					<li>and so on, up to 8-byte representations</li>
				</ul>
				<p>All numbers are stored in big-endian format.</p>
				<a href="#type" id="type" style="color: inherit; text-decoration: none;">
					<h3>Type</h3>
				</a>
				<p>The binary format of a type contains a byte identifying the class of the type followed by additional information to describe the type, if necessary.
				For example, <code>new sb.UnsignedIntType</code> translates into <code>[0x13]</code>, and <code>new sb.StructType({abc: new sb.ByteType, def: new sb.StringType})</code> translates into:</p>
				<pre><code class="language-javascript"><span style="color: #000000">[</span>
<span style="color: #000000">    </span><span style="color: #098658">0x51</span><span style="color: #000000"> </span><span style="color: #008000">/*StructType*/</span><span style="color: #000000">,</span>
<span style="color: #000000">        </span><span style="color: #098658">2</span><span style="color: #000000"> </span><span style="color: #008000">/*2 fields*/</span><span style="color: #000000">,</span>
<span style="color: #000000">            </span><span style="color: #008000">/*first field&#039;s name*/</span><span style="color: #000000">, </span><span style="color: #098658">0x61</span><span style="color: #000000"> </span><span style="color: #008000">/*a*/</span><span style="color: #000000">, </span><span style="color: #098658">0x62</span><span style="color: #000000"> </span><span style="color: #008000">/*b*/</span><span style="color: #000000">, </span><span style="color: #098658">0x63</span><span style="color: #000000"> </span><span style="color: #008000">/*c*/</span><span style="color: #000000">, </span><span style="color: #098658">0</span><span style="color: #000000">, </span><span style="color: #098658">0x01</span><span style="color: #000000"> </span><span style="color: #008000">/*ByteType*/</span><span style="color: #000000">,</span>
<span style="color: #000000">            </span><span style="color: #008000">/*second field&#039;s name*/</span><span style="color: #000000">, </span><span style="color: #098658">0x64</span><span style="color: #000000"> </span><span style="color: #008000">/*d*/</span><span style="color: #000000">, </span><span style="color: #098658">0x65</span><span style="color: #000000"> </span><span style="color: #008000">/*e*/</span><span style="color: #000000">, </span><span style="color: #098658">0x66</span><span style="color: #000000"> </span><span style="color: #008000">/*f*/</span><span style="color: #000000">, </span><span style="color: #098658">0</span><span style="color: #000000">, </span><span style="color: #098658">0x41</span><span style="color: #000000"> </span><span style="color: #008000">/*StringType*/</span>
<span style="color: #000000">]</span>
</code></pre>
				<p>If the type has already been written to the buffer, it is also valid to serialize the type as:</p>
				<ul>
					<li><code>0xFF</code></li>
					<li><code>offset</code> ([position of first byte of <code>offset</code> in buffer] - [position of type in buffer]) - <code>flexInt</code></li>
				</ul>
				<p>For example:</p>
				<pre><code class="language-javascript"><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">someType</span><span style="color: #000000"> = </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #795E26">TupleType</span><span style="color: #000000">({</span>
<span style="color: #000000">    </span><span style="color: #001080">type:</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #001080">FloatType</span><span style="color: #000000">,</span>
<span style="color: #000000">    </span><span style="color: #001080">length:</span><span style="color: #000000"> </span><span style="color: #098658">3</span>
<span style="color: #000000">})</span>
<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">type</span><span style="color: #000000"> = </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">sb</span><span style="color: #000000">.</span><span style="color: #795E26">StructType</span><span style="color: #000000">({</span>
<span style="color: #000000">    </span><span style="color: #001080">one:</span><span style="color: #000000"> </span><span style="color: #001080">someType</span><span style="color: #000000">,</span>
<span style="color: #000000">    </span><span style="color: #001080">two:</span><span style="color: #000000"> </span><span style="color: #001080">someType</span>
<span style="color: #000000">})</span>
<span style="color: #008000">// type serializes to</span>
<span style="color: #000000">[</span>
<span style="color: #000000">    </span><span style="color: #098658">0x51</span><span style="color: #000000"> </span><span style="color: #008000">/*StructType*/</span><span style="color: #000000">,</span>
<span style="color: #000000">        </span><span style="color: #098658">2</span><span style="color: #000000"> </span><span style="color: #008000">/*2 fields*/</span><span style="color: #000000">,</span>
<span style="color: #000000">            </span><span style="color: #008000">/*first field&#039;s name*/</span><span style="color: #000000">, </span><span style="color: #098658">0x6f</span><span style="color: #000000"> </span><span style="color: #008000">/*o*/</span><span style="color: #000000">, </span><span style="color: #098658">0x6e</span><span style="color: #000000"> </span><span style="color: #008000">/*n*/</span><span style="color: #000000">, </span><span style="color: #098658">0x65</span><span style="color: #000000"> </span><span style="color: #008000">/*e*/</span><span style="color: #000000">, </span><span style="color: #098658">0</span><span style="color: #000000">,</span>
<span style="color: #000000">                </span><span style="color: #098658">0x50</span><span style="color: #000000"> </span><span style="color: #008000">/*TupleType*/</span><span style="color: #000000">,</span>
<span style="color: #000000">                    </span><span style="color: #098658">0x20</span><span style="color: #000000"> </span><span style="color: #008000">/*FloatType*/</span><span style="color: #000000">,</span>
<span style="color: #000000">                    </span><span style="color: #098658">3</span><span style="color: #000000"> </span><span style="color: #008000">/*3 floats in the tuple*/</span><span style="color: #000000">,</span>
<span style="color: #000000">            </span><span style="color: #008000">/*second field&#039;s name*/</span><span style="color: #000000">, </span><span style="color: #098658">0x74</span><span style="color: #000000"> </span><span style="color: #008000">/*t*/</span><span style="color: #000000">, </span><span style="color: #098658">0x77</span><span style="color: #000000"> </span><span style="color: #008000">/*w*/</span><span style="color: #000000">, </span><span style="color: #098658">0x6f</span><span style="color: #000000"> </span><span style="color: #008000">/*o*/</span><span style="color: #000000">, </span><span style="color: #098658">0</span><span style="color: #000000">,</span>
<span style="color: #000000">                </span><span style="color: #098658">0xff</span><span style="color: #000000">, </span><span style="color: #008000">/*type is defined previously*/</span>
<span style="color: #000000">                    </span><span style="color: #098658">8</span><span style="color: #000000"> </span><span style="color: #008000">/*type is defined 8 bytes before this byte*/</span>
<span style="color: #000000">]</span>
</code></pre>
				<p>In the following definitions, <code>type</code> means the binary type format.</p>
				<ul>
					<li><code>ByteType</code>: identifier <code>0x01</code></li>
					<li><code>ShortType</code>: identifier <code>0x02</code></li>
					<li><code>IntType</code>: identifier <code>0x03</code></li>
					<li><code>LongType</code>: identifier <code>0x04</code></li>
					<li><code>BigIntType</code>: identifier <code>0x05</code></li>
					<li><code>FlexIntType</code>: identifier <code>0x07</code></li>
					<li><code>UnsignedByteType</code>: identifier <code>0x11</code></li>
					<li><code>UnsignedShortType</code>: identifier <code>0x12</code></li>
					<li><code>UnsignedIntType</code>: identifier <code>0x13</code></li>
					<li><code>UnsignedLongType</code>: identifier <code>0x14</code></li>
					<li><code>BigUnsignedIntType</code>: identifier <code>0x15</code></li>
					<li><code>FlexUnsignedIntType</code>: identifier <code>0x17</code></li>
					<li><code>DateType</code>: identifier <code>0x1A</code></li>
					<li><code>DayType</code>: identifier <code>0x1B</code></li>
					<li><code>TimeType</code>: identifier <code>0x1C</code></li>
					<li><code>FloatType</code>: identifier <code>0x20</code></li>
					<li><code>DoubleType</code>: identifier <code>0x21</code></li>
					<li><code>BooleanType</code>: identifier <code>0x30</code></li>
					<li><code>BooleanTupleType</code>: identifier <code>0x31</code>, payload:<ul>
							<li><code>length</code> - <code>flexInt</code></li>
						</ul>
					</li>
					<li><code>BooleanArrayType</code>: identifier <code>0x32</code></li>
					<li><code>CharType</code>: identifier <code>0x40</code></li>
					<li><code>StringType</code>: identifier <code>0x41</code></li>
					<li><code>OctetsType</code>: identifier <code>0x42</code></li>
					<li><code>TupleType</code>: identifier <code>0x50</code>, payload:<ul>
							<li><code>elementType</code> - <code>type</code></li>
							<li><code>length</code> - <code>flexInt</code></li>
						</ul>
					</li>
					<li><code>StructType</code>: identifier <code>0x51</code>, payload:<ul>
							<li><code>fieldCount</code> - <code>flexInt</code></li>
							<li><code>fieldCount</code> instances of <code>field</code>:<ul>
									<li><code>name</code> - a serialized <code>StringType</code> value</li>
									<li><code>fieldType</code> - <code>type</code></li>
								</ul>
							</li>
						</ul>
					</li>
					<li><code>ArrayType</code>: identifier <code>0x52</code>, payload:<ul>
							<li><code>elementType</code> - <code>type</code></li>
						</ul>
					</li>
					<li><code>SetType</code>: identifier <code>0x53</code>, payload identical to <code>ArrayType</code>:<ul>
							<li><code>elementType</code> - <code>type</code></li>
						</ul>
					</li>
					<li><code>MapType</code>: identifier <code>0x54</code>, payload:<ul>
							<li><code>keyType</code> - <code>type</code></li>
							<li><code>valueType</code> - <code>type</code></li>
						</ul>
					</li>
					<li><code>EnumType</code>: identifier <code>0x55</code>, payload:<ul>
							<li><code>valueType</code> - <code>type</code></li>
							<li><code>valueCount</code> - <code>flexInt</code></li>
							<li><code>valueCount</code> instances of <code>value</code>:<ul>
									<li><code>value</code> - a value that conforms to <code>valueType</code></li>
								</ul>
							</li>
						</ul>
					</li>
					<li><code>ChoiceType</code>: identifier <code>0x56</code>, payload:<ul>
							<li><code>typeCount</code> - <code>flexInt</code></li>
							<li><code>typeCount</code> instances of <code>possibleType</code>:<ul>
									<li><code>possibleType</code> - <code>type</code></li>
								</ul>
							</li>
						</ul>
					</li>
					<li><code>RecursiveType</code>: identifier <code>0x57</code>, payload:<ul>
							<li><code>recursiveID</code> (an identifier unique to this recursive type in this type buffer) - <code>flexInt</code></li>
							<li>If this is the first instance of this recursive type in this buffer:<ul>
									<li><code>recursiveType</code> (the type definition of this type) - <code>type</code></li>
								</ul>
							</li>
						</ul>
					</li>
					<li><code>SingletonType</code>: identifier <code>0x59</code>, payload:<ul>
							<li><code>valueType</code> - <code>type</code></li>
							<li><code>value</code> - a value that conforms to <code>valueType</code></li>
						</ul>
					</li>
					<li><code>OptionalType</code>: identifier <code>0x60</code>, payload:<ul>
							<li><code>typeIfNonNull</code> - <code>type</code></li>
						</ul>
					</li>
					<li><code>PointerType</code>: identifier <code>0x70</code>, payload:<ul>
							<li><code>targetType</code> - <code>type</code></li>
						</ul>
					</li>
				</ul>
				<a href="#value" id="value" style="color: inherit; text-decoration: none;">
					<h3>Value</h3>
				</a>
				<ul>
					<li><code>ByteType</code>: 1-byte integer</li>
					<li><code>ShortType</code>: 2-byte integer</li>
					<li><code>IntType</code>: 4-byte integer</li>
					<li><code>LongType</code>: 8-byte integer</li>
					<li><code>BigIntType</code>:<ul>
							<li><code>byteCount</code> - <code>flexInt</code></li>
							<li><code>number</code> - <code>byteCount</code>-byte integer</li>
						</ul>
					</li>
					<li><code>FlexIntType</code>: <code>flexInt</code> of <code>value * 2</code> if <code>value</code> is non-negative, <code>-2 * value - 1</code> if <code>value</code> is negative</li>
					<li><code>UnsignedByteType</code>: 1-byte unsigned integer</li>
					<li><code>UnsignedShortType</code>: 2-byte unsigned integer</li>
					<li><code>UnsignedIntType</code>: 4-byte unsigned integer</li>
					<li><code>UnsignedLongType</code>: 8-byte unsigned integer</li>
					<li><code>BigUnsignedIntType</code>:<ul>
							<li><code>byteCount</code> - <code>flexInt</code></li>
							<li><code>number</code> - <code>byteCount</code>-byte unsigned integer</li>
						</ul>
					</li>
					<li><code>FlexUnsignedIntType</code>: <code>flexInt</code></li>
					<li><code>DateType</code>: 8-byte signed integer storing milliseconds in <a href="https://en.wikipedia.org/wiki/Unix_time">Unix time</a></li>
					<li><code>DayType</code>: 3-byte signed integer storing days since the <a href="https://en.wikipedia.org/wiki/Unix_time">Unix time</a> epoch</li>
					<li><code>TimeType</code>: 4-byte unsigned integer storing milliseconds since the start of the day</li>
					<li><code>FloatType</code>: single precision (4-byte) <a href="https://en.wikipedia.org/wiki/IEEE_floating_point">IEEE floating point</a></li>
					<li><code>DoubleType</code>: double precision (8-byte) <a href="https://en.wikipedia.org/wiki/IEEE_floating_point">IEEE floating point</a></li>
					<li><code>BooleanType</code>: 1-byte value, either <code>0x00</code> for <code>false</code> or <code>0xFF</code> for <code>true</code></li>
					<li><code>BooleanTupleType</code>: <code>ceil(length / 8)</code> bytes, where the <code>n</code>th boolean is stored at the <code>(n % 8)</code>th MSB (<code>0</code>-indexed) of the <code>floor(n / 8)</code>th byte (<code>0</code>-indexed)</li>
					<li><code>BooleanArrayType</code>:<ul>
							<li><code>length</code> - <code>flexInt</code></li>
							<li><code>booleans</code> - <code>ceil(length / 8)</code> bytes, where the <code>n</code>th boolean is stored at the <code>(n % 8)</code>th MSB (<code>0</code>-indexed) of the <code>floor(n / 8)</code>th byte (<code>0</code>-indexed)</li>
						</ul>
					</li>
					<li><code>CharType</code>: UTF-8 codepoint (somewhere between 1 and 4 bytes long)</li>
					<li><code>StringType</code>:<ul>
							<li><code>string</code> - a UTF-8 string of any length not containing <code>&#39;\0&#39;</code></li>
							<li><code>0x00</code> to mark the end of the string</li>
						</ul>
					</li>
					<li><code>OctetsType</code>:<ul>
							<li><code>length</code> - <code>flexInt</code></li>
							<li><code>octets</code> - <code>length</code> bytes</li>
						</ul>
					</li>
					<li><code>TupleType</code>:<ul>
							<li><code>length</code> values serialized by <code>elementType</code></li>
						</ul>
					</li>
					<li><code>StructType</code>:<ul>
							<li>For each field in order of declaration in the type format:<ul>
									<li>The field&#39;s value serialized by <code>fieldType</code></li>
								</ul>
							</li>
						</ul>
					</li>
					<li><code>ArrayType</code>:<ul>
							<li><code>length</code> - <code>flexInt</code></li>
							<li><code>length</code> values serialized by <code>elementType</code></li>
						</ul>
					</li>
					<li><code>SetType</code>:<ul>
							<li><code>size</code> - <code>flexInt</code></li>
							<li><code>size</code> values serialized by <code>elementType</code></li>
						</ul>
					</li>
					<li><code>MapType</code>:<ul>
							<li><code>size</code> - <code>flexInt</code></li>
							<li><code>size</code> instances of <code>keyValuePair</code>:<ul>
									<li><code>key</code> - value serialized by <code>keyType</code></li>
									<li><code>value</code> - value serialized by <code>valueType</code></li>
								</ul>
							</li>
						</ul>
					</li>
					<li><code>EnumType</code>:<ul>
							<li><code>index</code> of value in values array - <code>flexInt</code></li>
						</ul>
					</li>
					<li><code>ChoiceType</code>:<ul>
							<li><code>index</code> of type in possible types array - <code>flexInt</code></li>
							<li><code>value</code> - value serialized by specified type</li>
						</ul>
					</li>
					<li><code>RecursiveType</code>:<ul>
							<li><code>valueNotYetWrittenInBuffer</code> - byte containing either <code>0x00</code> or <code>0xFF</code></li>
							<li>If <code>valueNotYetWrittenInBuffer</code>:<ul>
									<li><code>value</code> - value serialized by <code>recursiveType</code></li>
								</ul>
							</li>
							<li>Else:<ul>
									<li><code>offset</code> ([position of first byte of <code>offset</code> in buffer] - [position of <code>value</code> in buffer]) - <code>flexInt</code></li>
								</ul>
							</li>
						</ul>
					</li>
					<li><code>SingletonType</code>:<ul>
							<li>No value bytes</li>
						</ul>
					</li>
					<li><code>OptionalType</code>:<ul>
							<li><code>valueIsNonNull</code> - byte containing either <code>0x00</code> or <code>0xFF</code></li>
							<li>If <code>valueIsNonNull</code>:<ul>
									<li><code>value</code> - value serialized by <code>typeIfNonNull</code></li>
								</ul>
							</li>
						</ul>
					</li>
					<li><code>PointerType</code>:<ul>
							<li><code>offset</code> - <code>flexInt</code>:<ul>
									<li>If this is the first instance of these value bytes in the write buffer, then <code>0</code></li>
									<li>Otherwise, ([position of first byte of <code>offset</code>] - [position of first byte of <code>offset</code> in the last instance of these value bytes])</li>
								</ul>
							</li>
							<li>If <code>offset</code> is <code>0</code> (i.e. this is the first instance):<ul>
									<li>Value serialized by <code>targetType</code></li>
								</ul>
							</li>
						</ul>
					</li>
				</ul>
				<a href="#versioning" id="versioning" style="color: inherit; text-decoration: none;">
					<h2>Versioning</h2>
				</a>
				<p>Versions will be of the form <code>x.y.z</code>. They are in the <code>semver</code> format:</p>
				<ul>
					<li><code>x</code> is the major release; changes to it represent significant or breaking changes to the API, or to the type or value binary specification.</li>
					<li><code>y</code> is the minor release; changes to it represent new features that do not break backwards compatibility.</li>
					<li><code>z</code> is the patch release; changes to it represent bug fixes that do not change the documented API.</li>
				</ul>
				<a href="#testing" id="testing" style="color: inherit; text-decoration: none;">
					<h2>Testing</h2>
				</a>
				<p>To test the Node.js code, run <code>npm test</code>.
				To test the HTTP transaction code, run <code>node client-test/server.js</code> and open <code>localhost:8080</code> in your browser. Open each link in a new page. <code>Upload</code> and <code>Download</code> should each alert <code>Success</code>, while <code>Upload &amp; Download</code> should alert <code>Upload: Success</code> and <code>Download: Success</code>.</p>
				<p><em>Caleb Sander, 2017</em></p>
			</div>
		</div>
		<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
			<nav class="tsd-navigation primary">
				<ul>
					<li class=" ">
						<a href="modules.html">Modules</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/index.html">index</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/io.html">io</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/lib_appendable.html">lib/appendable</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/lib_appendable_stream.html">lib/appendable-<wbr>stream</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/lib_growable_buffer.html">lib/growable-<wbr>buffer</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/read.html">read</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/types.html">types</a>
					</li>
				</ul>
			</nav>
			<nav class="tsd-navigation secondary menu-sticky">
				<ul class="before-current">
				</ul>
			</nav>
		</div>
	</div>
</div>
<footer class="with-border-bottom">
	<div class="container">
		<h2>Legend</h2>
		<div class="tsd-legend-group">
			<ul class="tsd-legend">
				<li class="tsd-kind-variable"><span class="tsd-kind-icon">Variable</span></li>
				<li class="tsd-kind-function"><span class="tsd-kind-icon">Function</span></li>
				<li class="tsd-kind-function tsd-has-type-parameter"><span class="tsd-kind-icon">Function with type parameter</span></li>
				<li class="tsd-kind-type-alias"><span class="tsd-kind-icon">Type alias</span></li>
				<li class="tsd-kind-type-alias tsd-has-type-parameter"><span class="tsd-kind-icon">Type alias with type parameter</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-class"><span class="tsd-kind-icon">Class</span></li>
				<li class="tsd-kind-class tsd-has-type-parameter"><span class="tsd-kind-icon">Class with type parameter</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-interface tsd-has-type-parameter"><span class="tsd-kind-icon">Interface with type parameter</span></li>
			</ul>
		</div>
	</div>
</footer>
<div class="container tsd-generator">
	<p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p>
</div>
<div class="overlay"></div>
<script src="assets/js/main.js"></script>
</body>
</html>